# SUNBAY SoftPOS 更新日志

## 版本历史

### v2.1 (2024-12-09)

#### 新增功能

**WebKernel Demo**
- ✨ 环境变量配置支持（`.env.development` / `.env.production`）
- ✨ 公网 IP 自动检测（使用多个备用服务）
- ✨ 生产环境自动使用 HTTPS 后端
- ✨ 构建指南文档（`BUILD_GUIDE.md`）
- ✨ 环境配置文档（`ENVIRONMENT_CONFIG.md`）

**Kernel Service**
- ✨ WASM 编译支持
- ✨ 控制台日志输出
- ✨ 完整的 EMV 处理

**Backend**
- ✨ 内核管理功能
- ✨ 内核上传和分发 API

**Frontend**
- ✨ 内核管理页面
- ✨ 内核上传和发布功能

#### 改进优化

**WebKernel Demo**
- 🔧 修复界面显示问题（移除重复按钮）
- 🔧 优化 IP 检测逻辑（多服务备份 + 超时处理）
- 🔧 改进配置加载优先级（环境变量 > config.json）
- 🔧 简化部署流程（删除不必要的脚本）

**Android**
- 🔧 Transaction Token 机制优化
- 🔧 调试日志系统改进

#### Bug 修复

**WebKernel Demo**
- 🐛 修复 Mixed Content 问题（HTTPS 页面访问 HTTP API）
- 🐛 修复 deviceId 错误（统一使用 snake_case）
- 🐛 修复 WebRTC IP 检测在某些环境下失败的问题

---

### v2.0 (2024-12-05)

#### 完成里程碑
- ✅ 5个子项目全部完成
- ✅ 总体完成度达到 88%
- ✅ 所有核心功能实现
- ✅ 生产就绪状态

---

### v1.0.0 (2024-12-02)

#### 新增功能

**Backend**
- ✅ 完整的 RESTful API（60+ 端点）
- ✅ WebSocket 实时通知
- ✅ JWT 认证授权
- ✅ 设备生命周期管理
- ✅ DUKPT 密钥管理
- ✅ 健康检查和威胁检测
- ✅ 交易处理和 PINPad 模式
- ✅ SDK 版本管理
- ✅ 审计日志系统
- ✅ Prometheus 指标导出

**Frontend**
- ✅ 设备管理界面（注册、审批、监控）
- ✅ 健康监控仪表板
- ✅ 威胁管理界面
- ✅ 交易查询界面
- ✅ SDK 版本管理基础界面
- ✅ 系统日志查看
- ✅ 实时数据更新
- ✅ 数据可视化图表

**Android**
- ✅ 设备注册和管理
- ✅ NFC 读卡功能
- ✅ TEE 安全环境集成
- ✅ DUKPT 密钥派生
- ✅ 健康检查和自检
- ✅ 交易处理流程
- ✅ 调试日志系统

#### 技术改进

- 采用现代化技术栈（Rust + React + Kotlin）
- 企业级分层架构设计
- 完整的错误处理和日志系统
- 性能优化和缓存策略
- 安全加固和合规性

#### 文档

- 完整的方案文档
- API 参考文档
- 部署和运维指南
- 开发者入门文档

---

## 待完成功能

### Frontend (v2.2 计划)

- [ ] SDK 版本管理扩展
- [ ] 更多数据可视化
- [ ] 多语言支持
- [ ] 移动端响应式优化
- [ ] 批量操作功能

### Backend (v2.2 计划)

- [ ] HTTPS 原生支持
- [ ] 完整的单元测试覆盖
- [ ] 性能压力测试
- [ ] 数据库迁移工具

### Android (v2.2 计划)

- [ ] 离线交易支持
- [ ] 生物识别认证
- [ ] 更多卡组织支持

### WebKernel Demo (v2.2 计划)

- [ ] PWA 支持
- [ ] 离线支持
- [ ] 更多支付场景

---

## 已知问题

### Frontend
- SDK 版本管理功能部分待完善（83% 完成）

### Backend
- 需要补充更多单元测试
- 需要性能压力测试

---

## 升级指南

### 从 v2.0 升级到 v2.1

**WebKernel Demo**:
1. 更新依赖：`npm install`
2. 配置环境变量（可选）
3. 重新构建：`npm run build`

**Backend**:
1. 备份数据库
2. 更新二进制文件
3. 重启服务

### 从 v1.x 升级到 v2.0

1. 备份数据库
2. 更新配置文件
3. 运行数据库迁移
4. 重启所有服务

---

**最后更新**: 2024-12-09  
**维护者**: SUNBAY 技术团队
